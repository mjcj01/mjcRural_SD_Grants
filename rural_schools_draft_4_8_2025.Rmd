---
title: "Federal Funds and Rural Schools"
author: "Michael Cattell, Scott Levengood"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(extrafont)
# font_import()
loadfonts(device = "win")
source("Scripts//data_load.R", local = knitr::knit_global())
```

# Introduction

Rural schools face unique challenges. They exist distant from major economic centers, have high poverty rates, and have less infrastructure, like broadband internet, roads, or government services. Part of the effect these factors have on rural residents is the quality of their and their kids' education.

Grants and other programs from the federal government have the potential to act as an equalizer between districts situated in different contexts. This study investigates whether federal grants and programs harness this potential and actually serve as an equalizer.

# Literature Review

## Defining Rurality

-   Hoggart (1990): Argues against the monolithic "rural"

-   Nelson & Nguyen (2023): Creates a new measure for rurality using amenities available through OpenStreetMap

## Rural Schools

-   Schaft (2016): Rural school link with community well-being

-   Masumoto & Brown-Welty (2009): School and community relationship in rural districts that are "high-performing" and have high poverty rates.

-   Bauch (2001): School and community partnerships in rural districts

-   Boulden & Schimmel (2021): Analysis of a university-district partnership aimed at training and retaining school counselors

## Federal Funding in Schools

-   Kolbe & Rice (2012): Race to the Top (RTTP) and whether it improved funding

-   Brenner (2018): The impact of the ESSA on rural education

-   Yettick et al. (2014): Looking at ESEA and whether (and how) the administrative aspect of ESEA disadvantages rural school districts

-   Elliot et al. (2014): Impact of the Physical Education for Progress (PEP) federal grant in a school district

-   Herr & Brooks (2003): Not strictly federal, but discusses the impact of a lottery program akin to RTTP and the impact the lottery system has

-   Eppley (2009): Critical look at the impact of No Child Left Behind (NCLB) on rural schools, specifically the "highly qualified teacher" provision

# Data and Methods

## Data

Data for this study comes from the National Center for Education Statistics (NCES), which is the statistical arm for the U.S. Department of Education.

NCES provides a wide range of data through their Common Core of Data (CCD). Data on school district enrollment by race and locale classification (i.e., whether a district is considered urban, suburban, a town, or rural). Sourcing locale classifications from NCES provides a standardized comparison with other states, though utilizing a different rurality classification system is certainly possible. The definitions NCES uses for defining locales is in the table below.

```{r nces_locale_defs, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "NCES Locale Definition."}
library(gt)

nces_locale_classifications %>%
  gt() %>%
  cols_align(align = "center") %>%
  cols_width(Criteria ~ px(300)) %>%
  tab_options(data_row.padding = px(10))
```

School district revenue data comes from the most recent NCES School District Finance Survey, which was for the 2021-2022 school year. This survey collects school finance data for school districts (or local education agencies, as NCES refers to them as) in all 50 states plus Washington D.C. Revenue and expenditure data is aggregated by category, such as Title I funding, nutrition programs, and gifted education.

Initially, school district finance data from the Pennsylvania Department of Education (PDE) was used. PDE publishes school district finance data annually, with revenue and expenditure aggregated into smaller categories than NCES does. In order to get a broader view of school districts' revenue, these codes were grouped together (e.g., categories related to nutritional education and lunch programs were aggregated together). PDE's data, however, proved to be unreliable. Upon analysis of nutrition funding, only a handful of school districts were listed as receiving federal funds, a finding that is certainly false. Upon analysis of the NCES School District Finance Survey, this finding was confirmed and the data source used for this study was switched from PDE's data to data from NCES.

## Methods

Funding categories from the NCES School District Finance Survey will be picked and coded as funding one of five categories:

-   bilingual education,
-   career and technical education,
-   school meal programs,
-   special education programs,
-   teacher retention and training programs.

These categories were picked due to the clear overlap in language used in the Finance Survey between federal and state revenue. The lack of granularity within the Finance Survey is certainly a limitation of this study, though this is the best available data at the time of writing. While the PDE finance data provided more granular funding categories, the lack of actual data present in the files makes them unusable.

In order to evaluate 

# Who's Learning in Rural Schools?

Rural (and town) school districts are more racially homogeneous than their urban and suburban counterparts. They enroll predominantly White students, while having low proportions of Black, Hispanic, and Asian students.

```{r tot_stu_demog, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Student Enrollment Percentages Across Pennsylvania by Locale."}
library(gt)

pa_enrollment %>%
  select(leaid, race, enrollment) %>%
  merge(.,
        pa_directory %>%
          select(leaid, urban_centric_locale) %>% 
          mutate("locale" = ifelse(grepl("Rural", urban_centric_locale), "Rural",
                            ifelse(grepl("Town", urban_centric_locale), "Town",
                            ifelse(grepl("Suburb", urban_centric_locale), "Suburban",
                            ifelse(grepl("City", urban_centric_locale), "Urban", "check"))))) %>%
          select(-urban_centric_locale)) %>%
  filter(race != "Total" & race != "Unknown") %>%
  group_by(race, locale) %>%
  reframe("enrollment" = sum(enrollment)) %>%
  group_by(locale) %>%
  reframe("race" = race,
          "pct_enr" = (enrollment / sum(enrollment)) * 100) %>%
  rename(Locale = "locale") %>%
  pivot_wider(names_from = "race", values_from = "pct_enr") %>%
  mutate("Other Race" = `American Indian or Alaska Native` +
           `Native Hawaiian or other Pacific Islander` +
           `Two or more races`) %>%
  select(-`American Indian or Alaska Native`, 
         -`Native Hawaiian or other Pacific Islander`, 
         -`Two or more races`) %>%
  pivot_longer(cols = c(White, Black, Hispanic, Asian, `Other Race`)) %>%
  mutate(value = paste(round(value, digits = 2), "%", sep = "")) %>%
  pivot_wider(names_from = name, values_from = value) %>%
  gt() %>%
  cols_align(align = "center")
```

This is a trend that generally matches the communities these school districts are situated in (see Figure 1). Rural school districts also tend to have predominantly White populations reside in them and low percentages of other ethnoracial groups. There is also far less variation in how diverse these places are; while suburban and urban schools have a mix of schools predominantly enrolling one ethnoracial group and schools with diverse enrollment, no rural school has a White student enrollment percentage under 50%.

```{r enr_pop_xy_plot, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Student enrollment % vs. community population %, broken down by locale classification and ethnoracial group."}
pa_enrollment %>%
  select(leaid, race, enrollment) %>%
  filter(race != "Total") %>%
  group_by(leaid) %>%
  reframe("race" = race,
          "stu_pct" = enrollment / sum(enrollment)) %>%
  filter(race %in% c("Hispanic", "White", "Black", "Asian")) %>%
  merge(., census_pop, by.x = c("leaid", "race"), by.y = c("GEOID", "variable")) %>%
  merge(.,
        pa_directory %>%
          select(leaid, urban_centric_locale) %>% 
          mutate("locale" = ifelse(grepl("Rural", urban_centric_locale), "Rural",
                                   ifelse(grepl("Town", urban_centric_locale), "Town",
                                          ifelse(grepl("Suburb", urban_centric_locale), "Suburban",
                                                 ifelse(grepl("City", urban_centric_locale), "Urban", "check"))))),
        by = "leaid") %>%
  ggplot(aes(x = stu_pct, y = pop_pct, color = race)) +
  geom_point() +
  facet_wrap(vars(locale)) +
  geom_abline(slope = 1, color = "#000000") +
  theme_minimal() +
  scale_x_continuous(labels = scales::label_percent()) +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_color_discrete(name = "Ethnoracial Group") +
  labs(x = "Student Enrollment %",
       y = "Community Population Percentage") +
  theme(text = element_text(family = "Tinos"))
```

Additionally, this is also a broad spatial pattern for rural school districts across the state (see Figure 2). Only two districts have a non-White ethnoracial group make up more than 25% of their student population; 29% of students enrolled in both Pocono Mountain and Upper Adams School Districts are Hispanic.

```{r tot_stu_demog_map, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Map of Rural School Districts, Colored by Enrollment Percentages."}
pa_enrollment %>%
  filter(leaid %in% rural_school_directory$leaid) %>%
  filter(race != "Total" & race != "Unknown") %>%
  select(leaid, race, enrollment) %>%
  pivot_wider(names_from = race, values_from = enrollment) %>%
  mutate("Other Race" = `American Indian or Alaska Native` +
           `Native Hawaiian or other Pacific Islander` +
           `Two or more races`) %>%
  select(-`American Indian or Alaska Native`, 
         -`Native Hawaiian or other Pacific Islander`, 
         -`Two or more races`) %>%
  pivot_longer(cols = c(White, Black, Hispanic, Asian, `Other Race`),
               names_to = "Race", values_to = "Enrollment") %>%
  group_by(leaid) %>%
  reframe(Race = Race,
          `% Enrollment` = Enrollment / sum(Enrollment)) %>%
  merge(., pa_school_districts, by.x = "leaid", by.y = "GEOID") %>%
  st_as_sf() %>%
  ggplot() +
  geom_sf(aes(fill = `% Enrollment`), linewidth = 0, color = "#FFFFFF") +
  facet_wrap(vars(Race), ncol = 2) +
  theme_void() +
  scale_fill_fermenter(direction = 1, palette = "PuBuGn",
                       labels = scales::label_percent()) +
  theme(text = element_text(family = "Tinos"))
```



# Results

As a starting point for analysis, linear regression was tested to see the correlation between state funding in the five selected categories and federal funding. If federal funding were behaving as an equalizer, the expectation is there would be a negative relationship between federal and state funding in each category; as you can increase state funding in a category, federal funding would decrease.

```{r initial_regression, echo = FALSE, message = FALSE, warning = FALSE}
library(gt)
initial_reg_table <- NULL
for (i in unique(fed_sta_comp$name)) {
  lm <- fed_sta_comp %>%
    filter(name == i & locale == "Rural") %>%
    lm(data = ., formula = fed_rev ~ sta_rev) %>%
    summary()
  
  df <- tibble("Category" = c(i),
               "Estimate" = c(lm$coefficients[2,1]),
               "Std. Error" = c(lm$coefficients[2,2]),
               "t Value" = c(lm$coefficients[2,3]),
               "p Value" = c(lm$coefficients[2,4]),
               "R^2 Value" = c(lm$r.squared))
  initial_reg_table <- rbind(initial_reg_table, df)
}
initial_reg_table %>%
  gt()
```


The discussion of results is broken into three parts:

-   Variations in federal nutrition and school meal funding,
-   Federal teacher training and retention funding,
-   Where rural-specific federal funding

## Nutrition Programs

School meal funding is somewhat unique among school funding categories; while most categories are heavily reliant on state revenue to provide funding, the vast majority of school meal funding comes from the federal government. This pattern holds true in Pennsylvania.

## School Staff Funding

## Rural-Specific Federal Grants

# Conclusions
